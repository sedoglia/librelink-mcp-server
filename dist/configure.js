#!/usr/bin/env node
/**
 * CLI Configuration Tool for LibreLink MCP Server
 *
 * Usage: npm run configure
 *
 * Credentials are stored securely using:
 * - AES-256-GCM encryption for data at rest
 * - Encryption keys stored in OS keychain via Keytar
 */
import * as readline from 'readline';
import { ConfigManager } from './config.js';
import { LibreLinkClient } from './librelink-client.js';
const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout
});
function question(prompt) {
    return new Promise((resolve) => {
        rl.question(prompt, (answer) => {
            resolve(answer.trim());
        });
    });
}
function questionHidden(prompt) {
    return new Promise((resolve) => {
        process.stdout.write(prompt);
        const stdin = process.stdin;
        const wasRaw = stdin.isRaw;
        if (stdin.isTTY) {
            stdin.setRawMode(true);
        }
        let password = '';
        const onData = (char) => {
            const c = char.toString('utf8');
            switch (c) {
                case '\n':
                case '\r':
                case '\u0004':
                    if (stdin.isTTY) {
                        stdin.setRawMode(wasRaw);
                    }
                    stdin.removeListener('data', onData);
                    console.log('');
                    resolve(password);
                    break;
                case '\u0003':
                    process.exit();
                    break;
                case '\u007F':
                case '\b':
                    password = password.slice(0, -1);
                    break;
                default:
                    password += c;
                    process.stdout.write('*');
                    break;
            }
        };
        stdin.on('data', onData);
        stdin.resume();
    });
}
async function main() {
    console.log('');
    console.log('LibreLink MCP Server Configuration');
    console.log('===================================');
    console.log('');
    console.log('This tool will configure your LibreLink credentials.');
    console.log('');
    console.log('SECURITY: Your credentials are stored securely using:');
    console.log('  - AES-256-GCM encryption for data at rest');
    console.log('  - Encryption keys stored in your OS keychain');
    console.log('');
    console.log('IMPORTANT: Use your LibreLinkUp credentials (not LibreLink)');
    console.log('  - LibreLinkUp is the follower/sharing app');
    console.log('  - Make sure data sharing is enabled in the LibreLink app');
    console.log('');
    const configManager = new ConfigManager();
    // Try to migrate legacy config
    const migrated = await configManager.migrateFromLegacy();
    if (migrated) {
        console.log('Migrated existing credentials to secure storage.');
        console.log('');
    }
    // Load existing credentials
    await configManager.loadCredentials();
    const existingCredentials = await configManager.getCredentials();
    const ranges = configManager.getTargetRanges();
    const region = configManager.getRegion();
    // Get email
    const emailPrompt = existingCredentials?.email
        ? `Email [${existingCredentials.email}]: `
        : 'Email: ';
    let email = await question(emailPrompt);
    if (!email && existingCredentials?.email) {
        email = existingCredentials.email;
    }
    if (!email) {
        console.log('Email is required');
        rl.close();
        process.exit(1);
    }
    // Get password
    console.log('');
    const passwordPrompt = existingCredentials?.password
        ? 'Password (press Enter to keep existing): '
        : 'Password: ';
    let password = await questionHidden(passwordPrompt);
    if (!password && existingCredentials?.password) {
        password = existingCredentials.password;
        console.log('(keeping existing password)');
    }
    if (!password) {
        console.log('Password is required');
        rl.close();
        process.exit(1);
    }
    // Get region
    console.log('');
    console.log('Region options:');
    console.log('  EU - Europe (default)');
    console.log('  US - United States');
    console.log('  DE - Germany');
    console.log('  FR - France');
    console.log('  AP - Asia Pacific');
    console.log('  AU - Australia');
    console.log('');
    const regionPrompt = `Region [${region}]: `;
    let newRegion = (await question(regionPrompt)).toUpperCase();
    if (!newRegion) {
        newRegion = region;
    }
    const validRegions = ['EU', 'US', 'DE', 'FR', 'AP', 'AU'];
    if (!validRegions.includes(newRegion)) {
        console.log(`Invalid region. Must be one of: ${validRegions.join(', ')}`);
        rl.close();
        process.exit(1);
    }
    // Get target ranges
    console.log('');
    console.log('Target glucose ranges (mg/dL):');
    const lowPrompt = `Target Low [${ranges.targetLow}]: `;
    const lowInput = await question(lowPrompt);
    const targetLow = lowInput ? parseInt(lowInput, 10) : ranges.targetLow;
    const highPrompt = `Target High [${ranges.targetHigh}]: `;
    const highInput = await question(highPrompt);
    const targetHigh = highInput ? parseInt(highInput, 10) : ranges.targetHigh;
    if (targetLow >= targetHigh) {
        console.log('Target low must be less than target high');
        rl.close();
        process.exit(1);
    }
    // Save configuration
    console.log('');
    console.log('Saving configuration...');
    try {
        // Save credentials securely
        await configManager.updateCredentials(email, password);
        // Save other settings
        configManager.updateRegion(newRegion);
        configManager.updateRanges(targetLow, targetHigh);
        const paths = configManager.getSecureStoragePaths();
        console.log('Configuration saved!');
        console.log('');
        console.log('Storage locations:');
        console.log(`  Encrypted credentials: ${paths.credentialsPath}`);
        console.log(`  Encryption key: Stored in OS keychain`);
        console.log(`  Settings: ${configManager.getConfigPath()}`);
    }
    catch (error) {
        console.log(`Failed to save configuration: ${error}`);
        rl.close();
        process.exit(1);
    }
    // Test connection
    console.log('');
    console.log('Testing connection to LibreLinkUp...');
    try {
        const config = await configManager.getConfig();
        const client = new LibreLinkClient(config, configManager);
        await client.validateConnection();
        console.log('Connection successful!');
        const glucose = await client.getCurrentGlucose();
        const sessionStatus = client.getSessionStatus();
        console.log('');
        console.log('Current glucose reading:');
        console.log(`  Value: ${glucose.value} mg/dL`);
        console.log(`  Trend: ${glucose.trend}`);
        console.log(`  Status: ${glucose.color === 'green' ? 'In Range' : glucose.color === 'red' ? 'Critical' : 'Out of Range'}`);
        console.log('');
        console.log('Session info:');
        console.log(`  Token valid until: ${sessionStatus.expiresAt?.toLocaleString() || 'N/A'}`);
    }
    catch (error) {
        console.log(`Connection failed: ${error}`);
        console.log('');
        console.log('Troubleshooting:');
        console.log('  1. Verify your email and password are correct');
        console.log('  2. Make sure you are using LibreLinkUp credentials');
        console.log('  3. Open the LibreLinkUp app and accept any Terms & Conditions');
        console.log('  4. Ensure someone is sharing data with you (or share your own data)');
        console.log('  5. Check that your region setting is correct');
        rl.close();
        process.exit(1);
    }
    console.log('');
    console.log('Configuration complete!');
    console.log('');
    console.log('Next steps:');
    console.log('  1. Add the server to Claude Desktop configuration');
    console.log('  2. Restart Claude Desktop');
    console.log('  3. Ask Claude about your glucose levels!');
    rl.close();
}
main().catch((error) => {
    console.error('Error:', error);
    process.exit(1);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlndXJlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2NvbmZpZ3VyZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBRUE7Ozs7Ozs7O0dBUUc7QUFFSCxPQUFPLEtBQUssUUFBUSxNQUFNLFVBQVUsQ0FBQztBQUNyQyxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBQzVDLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUV4RCxNQUFNLEVBQUUsR0FBRyxRQUFRLENBQUMsZUFBZSxDQUFDO0lBQ2xDLEtBQUssRUFBRSxPQUFPLENBQUMsS0FBSztJQUNwQixNQUFNLEVBQUUsT0FBTyxDQUFDLE1BQU07Q0FDdkIsQ0FBQyxDQUFDO0FBRUgsU0FBUyxRQUFRLENBQUMsTUFBYztJQUM5QixPQUFPLElBQUksT0FBTyxDQUFDLENBQUMsT0FBTyxFQUFFLEVBQUU7UUFDN0IsRUFBRSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxNQUFNLEVBQUUsRUFBRTtZQUM3QixPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7UUFDekIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUM7QUFFRCxTQUFTLGNBQWMsQ0FBQyxNQUFjO0lBQ3BDLE9BQU8sSUFBSSxPQUFPLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRTtRQUM3QixPQUFPLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUU3QixNQUFNLEtBQUssR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDO1FBQzVCLE1BQU0sTUFBTSxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUM7UUFFM0IsSUFBSSxLQUFLLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDaEIsS0FBSyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN6QixDQUFDO1FBRUQsSUFBSSxRQUFRLEdBQUcs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QU8sQ0FBQyxHQUFHLENBQUMsc0RBQXNELENBQUMsQ0FBQztRQUNwRSxPQUFPLENBQUMsR0FBRyxDQUFDLGlFQUFpRSxDQUFDLENBQUM7UUFDL0UsT0FBTyxDQUFDLEdBQUcsQ0FBQyx1RUFBdUUsQ0FBQyxDQUFDO1FBQ3JGLE9BQU8sQ0FBQyxHQUFHLENBQUMsZ0RBQWdELENBQUMsQ0FBQztRQUM5RCxFQUFFLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDWCxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2xCLENBQUM7SUFFRCxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ2hCLE9BQU8sQ0FBQyxHQUFHLENBQUMseUJBQXlCLENBQUMsQ0FBQztJQUN2QyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ2hCLE9BQU8sQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLENBQUM7SUFDM0IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxxREFBcUQsQ0FBQyxDQUFDO0lBQ25FLE9BQU8sQ0FBQyxHQUFHLENBQUMsNkJBQTZCLENBQUMsQ0FBQztJQUMzQyxPQUFPLENBQUMsR0FBRyxDQUFDLDRDQUE0QyxDQUFDLENBQUM7SUFFMUQsRUFBRSxDQUFDLEtBQUssRUFBRSxDQUFDO0FBQ2IsQ0FBQztBQUVELElBQUksRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFO0lBQ3JCLE9BQU8sQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQy9CLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDbEIsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIjIS91c3IvYmluL2VudiBub2RlXG5cbi8qKlxuICogQ0xJIENvbmZpZ3VyYXRpb24gVG9vbCBmb3IgTGlicmVMaW5rIE1DUCBTZXJ2ZXJcbiAqXG4gKiBVc2FnZTogbnBtIHJ1biBjb25maWd1cmVcbiAqXG4gKiBDcmVkZW50aWFscyBhcmUgc3RvcmVkIHNlY3VyZWx5IHVzaW5nOlxuICogLSBBRVMtMjU2LUdDTSBlbmNyeXB0aW9uIGZvciBkYXRhIGF0IHJlc3RcbiAqIC0gRW5jcnlwdGlvbiBrZXlzIHN0b3JlZCBpbiBPUyBrZXljaGFpbiB2aWEgS2V5dGFyXG4gKi9cblxuaW1wb3J0ICogYXMgcmVhZGxpbmUgZnJvbSAncmVhZGxpbmUnO1xuaW1wb3J0IHsgQ29uZmlnTWFuYWdlciB9IGZyb20gJy4vY29uZmlnLmpzJztcbmltcG9ydCB7IExpYnJlTGlua0NsaWVudCB9IGZyb20gJy4vbGlicmVsaW5rLWNsaWVudC5qcyc7XG5cbmNvbnN0IHJsID0gcmVhZGxpbmUuY3JlYXRlSW50ZXJmYWNlKHtcbiAgaW5wdXQ6IHByb2Nlc3Muc3RkaW4sXG4gIG91dHB1dDogcHJvY2Vzcy5zdGRvdXRcbn0pO1xuXG5mdW5jdGlvbiBxdWVzdGlvbihwcm9tcHQ6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgIHJsLnF1ZXN0aW9uKHByb21wdCwgKGFuc3dlcikgPT4ge1xuICAgICAgcmVzb2x2ZShhbnN3ZXIudHJpbSgpKTtcbiAgICB9KTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHF1ZXN0aW9uSGlkZGVuKHByb21wdDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUocHJvbXB0KTtcblxuICAgIGNvbnN0IHN0ZGluID0gcHJvY2Vzcy5zdGRpbjtcbiAgICBjb25zdCB3YXNSYXcgPSBzdGRpbi5pc1JhdztcblxuICAgIGlmIChzdGRpbi5pc1RUWSkge1xuICAgICAgc3RkaW4uc2V0UmF3TW9kZSh0cnVlKTtcbiAgICB9XG5cbiAgICBsZXQgcGFzc3dvcmQgPSAnJztcblxuICAgIGNvbnN0IG9uRGF0YSA9IChjaGFyOiBCdWZmZXIpID0+IHtcbiAgICAgIGNvbnN0IGMgPSBjaGFyLnRvU3RyaW5nKCd1dGY4Jyk7XG5cbiAgICAgIHN3aXRjaCAoYykge1xuICAgICAgICBjYXNlICdcXG4nOlxuICAgICAgICBjYXNlICdcXHInOlxuICAgICAgICBjYXNlICdcXHUwMDA0JzpcbiAgICAgICAgICBpZiAoc3RkaW4uaXNUVFkpIHtcbiAgICAgICAgICAgIHN0ZGluLnNldFJhd01vZGUod2FzUmF3KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgc3RkaW4ucmVtb3ZlTGlzdGVuZXIoJ2RhdGEnLCBvbkRhdGEpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKCcnKTtcbiAgICAgICAgICByZXNvbHZlKHBhc3N3b3JkKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnXFx1MDAwMyc6XG4gICAgICAgICAgcHJvY2Vzcy5leGl0KCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ1xcdTAwN0YnOlxuICAgICAgICBjYXNlICdcXGInOlxuICAgICAgICAgIHBhc3N3b3JkID0gcGFzc3dvcmQuc2xpY2UoMCwgLTEpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHBhc3N3b3JkICs9IGM7XG4gICAgICAgICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUoJyonKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgc3RkaW4ub24oJ2RhdGEnLCBvbkRhdGEpO1xuICAgIHN0ZGluLnJlc3VtZSgpO1xuICB9KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gbWFpbigpIHtcbiAgY29uc29sZS5sb2coJycpO1xuICBjb25zb2xlLmxvZygnTGlicmVMaW5rIE1DUCBTZXJ2ZXIgQ29uZmlndXJhdGlvbicpO1xuICBjb25zb2xlLmxvZygnPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0nKTtcbiAgY29uc29sZS5sb2coJycpO1xuICBjb25zb2xlLmxvZygnVGhpcyB0b29sIHdpbGwgY29uZmlndXJlIHlvdXIgTGlicmVMaW5rIGNyZWRlbnRpYWxzLicpO1xuICBjb25zb2xlLmxvZygnJyk7XG4gIGNvbnNvbGUubG9nKCdTRUNVUklUWTogWW91ciBjcmVkZW50aWFscyBhcmUgc3RvcmVkIHNlY3VyZWx5IHVzaW5nOicpO1xuICBjb25zb2xlLmxvZygnICAtIEFFUy0yNTYtR0NNIGVuY3J5cHRpb24gZm9yIGRhdGEgYXQgcmVzdCcpO1xuICBjb25zb2xlLmxvZygnICAtIEVuY3J5cHRpb24ga2V5cyBzdG9yZWQgaW4geW91ciBPUyBrZXljaGFpbicpO1xuICBjb25zb2xlLmxvZygnJyk7XG4gIGNvbnNvbGUubG9nKCdJTVBPUlRBTlQ6IFVzZSB5b3VyIExpYnJlTGlua1VwIGNyZWRlbnRpYWxzIChub3QgTGlicmVMaW5rKScpO1xuICBjb25zb2xlLmxvZygnICAtIExpYnJlTGlua1VwIGlzIHRoZSBmb2xsb3dlci9zaGFyaW5nIGFwcCcpO1xuICBjb25zb2xlLmxvZygnICAtIE1ha2Ugc3VyZSBkYXRhIHNoYXJpbmcgaXMgZW5hYmxlZCBpbiB0aGUgTGlicmVMaW5rIGFwcCcpO1xuICBjb25zb2xlLmxvZygnJyk7XG5cbiAgY29uc3QgY29uZmlnTWFuYWdlciA9IG5ldyBDb25maWdNYW5hZ2VyKCk7XG5cbiAgLy8gVHJ5IHRvIG1pZ3JhdGUgbGVnYWN5IGNvbmZpZ1xuICBjb25zdCBtaWdyYXRlZCA9IGF3YWl0IGNvbmZpZ01hbmFnZXIubWlncmF0ZUZyb21MZWdhY3koKTtcbiAgaWYgKG1pZ3JhdGVkKSB7XG4gICAgY29uc29sZS5sb2coJ01pZ3JhdGVkIGV4aXN0aW5nIGNyZWRlbnRpYWxzIHRvIHNlY3VyZSBzdG9yYWdlLicpO1xuICAgIGNvbnNvbGUubG9nKCcnKTtcbiAgfVxuXG4gIC8vIExvYWQgZXhpc3RpbmcgY3JlZGVudGlhbHNcbiAgYXdhaXQgY29uZmlnTWFuYWdlci5sb2FkQ3JlZGVudGlhbHMoKTtcbiAgY29uc3QgZXhpc3RpbmdDcmVkZW50aWFscyA9IGF3YWl0IGNvbmZpZ01hbmFnZXIuZ2V0Q3JlZGVudGlhbHMoKTtcbiAgY29uc3QgcmFuZ2VzID0gY29uZmlnTWFuYWdlci5nZXRUYXJnZXRSYW5nZXMoKTtcbiAgY29uc3QgcmVnaW9uID0gY29uZmlnTWFuYWdlci5nZXRSZWdpb24oKTtcblxuICAvLyBHZXQgZW1haWxcbiAgY29uc3QgZW1haWxQcm9tcHQgPSBleGlzdGluZ0NyZWRlbnRpYWxzPy5lbWFpbFxuICAgID8gYEVtYWlsIFske2V4aXN0aW5nQ3JlZGVudGlhbHMuZW1haWx9XTogYFxuICAgIDogJ0VtYWlsOiAnO1xuICBsZXQgZW1haWwgPSBhd2FpdCBxdWVzdGlvbihlbWFpbFByb21wdCk7XG4gIGlmICghZW1haWwgJiYgZXhpc3RpbmdDcmVkZW50aWFscz8uZW1haWwpIHtcbiAgICBlbWFpbCA9IGV4aXN0aW5nQ3JlZGVudGlhbHMuZW1haWw7XG4gIH1cblxuICBpZiAoIWVtYWlsKSB7XG4gICAgY29uc29sZS5sb2coJ0VtYWlsIGlzIHJlcXVpcmVkJyk7XG4gICAgcmwuY2xvc2UoKTtcbiAgICBwcm9jZXNzLmV4aXQoMSk7XG4gIH1cblxuICAvLyBHZXQgcGFzc3dvcmRcbiAgY29uc29sZS5sb2coJycpO1xuICBjb25zdCBwYXNzd29yZFByb21wdCA9IGV4aXN0aW5nQ3JlZGVudGlhbHM/LnBhc3N3b3JkXG4gICAgPyAnUGFzc3dvcmQgKHByZXNzIEVudGVyIHRvIGtlZXAgZXhpc3RpbmcpOiAnXG4gICAgOiAnUGFzc3dvcmQ6ICc7XG4gIGxldCBwYXNzd29yZCA9IGF3YWl0IHF1ZXN0aW9uSGlkZGVuKHBhc3N3b3JkUHJvbXB0KTtcbiAgaWYgKCFwYXNzd29yZCAmJiBleGlzdGluZ0NyZWRlbnRpYWxzPy5wYXNzd29yZCkge1xuICAgIHBhc3N3b3JkID0gZXhpc3RpbmdDcmVkZW50aWFscy5wYXNzd29yZDtcbiAgICBjb25zb2xlLmxvZygnKGtlZXBpbmcgZXhpc3RpbmcgcGFzc3dvcmQpJyk7XG4gIH1cblxuICBpZiAoIXBhc3N3b3JkKSB7XG4gICAgY29uc29sZS5sb2coJ1Bhc3N3b3JkIGlzIHJlcXVpcmVkJyk7XG4gICAgcmwuY2xvc2UoKTtcbiAgICBwcm9jZXNzLmV4aXQoMSk7XG4gIH1cblxuICAvLyBHZXQgcmVnaW9uXG4gIGNvbnNvbGUubG9nKCcnKTtcbiAgY29uc29sZS5sb2coJ1JlZ2lvbiBvcHRpb25zOicpO1xuICBjb25zb2xlLmxvZygnICBFVSAtIEV1cm9wZSAoZGVmYXVsdCknKTtcbiAgY29uc29sZS5sb2coJyAgVVMgLSBVbml0ZWQgU3RhdGVzJyk7XG4gIGNvbnNvbGUubG9nKCcgIERFIC0gR2VybWFueScpO1xuICBjb25zb2xlLmxvZygnICBGUiAtIEZyYW5jZScpO1xuICBjb25zb2xlLmxvZygnICBBUCAtIEFzaWEgUGFjaWZpYycpO1xuICBjb25zb2xlLmxvZygnICBBVSAtIEF1c3RyYWxpYScpO1xuICBjb25zb2xlLmxvZygnJyk7XG5cbiAgY29uc3QgcmVnaW9uUHJvbXB0ID0gYFJlZ2lvbiBbJHtyZWdpb259XTogYDtcbiAgbGV0IG5ld1JlZ2lvbiA9IChhd2FpdCBxdWVzdGlvbihyZWdpb25Qcm9tcHQpKS50b1VwcGVyQ2FzZSgpIGFzICdFVScgfCAnVVMnIHwgJ0RFJyB8ICdGUicgfCAnQVAnIHwgJ0FVJztcbiAgaWYgKCFuZXdSZWdpb24pIHtcbiAgICBuZXdSZWdpb24gPSByZWdpb247XG4gIH1cblxuICBjb25zdCB2YWxpZFJlZ2lvbnMgPSBbJ0VVJywgJ1VTJywgJ0RFJywgJ0ZSJywgJ0FQJywgJ0FVJ107XG4gIGlmICghdmFsaWRSZWdpb25zLmluY2x1ZGVzKG5ld1JlZ2lvbikpIHtcbiAgICBjb25zb2xlLmxvZyhgSW52YWxpZCByZWdpb24uIE11c3QgYmUgb25lIG9mOiAke3ZhbGlkUmVnaW9ucy5qb2luKCcsICcpfWApO1xuICAgIHJsLmNsb3NlKCk7XG4gICAgcHJvY2Vzcy5leGl0KDEpO1xuICB9XG5cbiAgLy8gR2V0IHRhcmdldCByYW5nZXNcbiAgY29uc29sZS5sb2coJycpO1xuICBjb25zb2xlLmxvZygnVGFyZ2V0IGdsdWNvc2UgcmFuZ2VzIChtZy9kTCk6Jyk7XG5cbiAgY29uc3QgbG93UHJvbXB0ID0gYFRhcmdldCBMb3cgWyR7cmFuZ2VzLnRhcmdldExvd31dOiBgO1xuICBjb25zdCBsb3dJbnB1dCA9IGF3YWl0IHF1ZXN0aW9uKGxvd1Byb21wdCk7XG4gIGNvbnN0IHRhcmdldExvdyA9IGxvd0lucHV0ID8gcGFyc2VJbnQobG93SW5wdXQsIDEwKSA6IHJhbmdlcy50YXJnZXRMb3c7XG5cbiAgY29uc3QgaGlnaFByb21wdCA9IGBUYXJnZXQgSGlnaCBbJHtyYW5nZXMudGFyZ2V0SGlnaH1dOiBgO1xuICBjb25zdCBoaWdoSW5wdXQgPSBhd2FpdCBxdWVzdGlvbihoaWdoUHJvbXB0KTtcbiAgY29uc3QgdGFyZ2V0SGlnaCA9IGhpZ2hJbnB1dCA/IHBhcnNlSW50KGhpZ2hJbnB1dCwgMTApIDogcmFuZ2VzLnRhcmdldEhpZ2g7XG5cbiAgaWYgKHRhcmdldExvdyA+PSB0YXJnZXRIaWdoKSB7XG4gICAgY29uc29sZS5sb2coJ1RhcmdldCBsb3cgbXVzdCBiZSBsZXNzIHRoYW4gdGFyZ2V0IGhpZ2gnKTtcbiAgICBybC5jbG9zZSgpO1xuICAgIHByb2Nlc3MuZXhpdCgxKTtcbiAgfVxuXG4gIC8vIFNhdmUgY29uZmlndXJhdGlvblxuICBjb25zb2xlLmxvZygnJyk7XG4gIGNvbnNvbGUubG9nKCdTYXZpbmcgY29uZmlndXJhdGlvbi4uLicpO1xuXG4gIHRyeSB7XG4gICAgLy8gU2F2ZSBjcmVkZW50aWFscyBzZWN1cmVseVxuICAgIGF3YWl0IGNvbmZpZ01hbmFnZXIudXBkYXRlQ3JlZGVudGlhbHMoZW1haWwsIHBhc3N3b3JkKTtcblxuICAgIC8vIFNhdmUgb3RoZXIgc2V0dGluZ3NcbiAgICBjb25maWdNYW5hZ2VyLnVwZGF0ZVJlZ2lvbihuZXdSZWdpb24pO1xuICAgIGNvbmZpZ01hbmFnZXIudXBkYXRlUmFuZ2VzKHRhcmdldExvdywgdGFyZ2V0SGlnaCk7XG5cbiAgICBjb25zdCBwYXRocyA9IGNvbmZpZ01hbmFnZXIuZ2V0U2VjdXJlU3RvcmFnZVBhdGhzKCk7XG4gICAgY29uc29sZS5sb2coJ0NvbmZpZ3VyYXRpb24gc2F2ZWQhJyk7XG4gICAgY29uc29sZS5sb2coJycpO1xuICAgIGNvbnNvbGUubG9nKCdTdG9yYWdlIGxvY2F0aW9uczonKTtcbiAgICBjb25zb2xlLmxvZyhgICBFbmNyeXB0ZWQgY3JlZGVudGlhbHM6ICR7cGF0aHMuY3JlZGVudGlhbHNQYXRofWApO1xuICAgIGNvbnNvbGUubG9nKGAgIEVuY3J5cHRpb24ga2V5OiBTdG9yZWQgaW4gT1Mga2V5Y2hhaW5gKTtcbiAgICBjb25zb2xlLmxvZyhgICBTZXR0aW5nczogJHtjb25maWdNYW5hZ2VyLmdldENvbmZpZ1BhdGgoKX1gKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmxvZyhgRmFpbGVkIHRvIHNhdmUgY29uZmlndXJhdGlvbjogJHtlcnJvcn1gKTtcbiAgICBybC5jbG9zZSgpO1xuICAgIHByb2Nlc3MuZXhpdCgxKTtcbiAgfVxuXG4gIC8vIFRlc3QgY29ubmVjdGlvblxuICBjb25zb2xlLmxvZygnJyk7XG4gIGNvbnNvbGUubG9nKCdUZXN0aW5nIGNvbm5lY3Rpb24gdG8gTGlicmVMaW5rVXAuLi4nKTtcblxuICB0cnkge1xuICAgIGNvbnN0IGNvbmZpZyA9IGF3YWl0IGNvbmZpZ01hbmFnZXIuZ2V0Q29uZmlnKCk7XG4gICAgY29uc3QgY2xpZW50ID0gbmV3IExpYnJlTGlua0NsaWVudChjb25maWcsIGNvbmZpZ01hbmFnZXIpO1xuICAgIGF3YWl0IGNsaWVudC52YWxpZGF0ZUNvbm5lY3Rpb24oKTtcblxuICAgIGNvbnNvbGUubG9nKCdDb25uZWN0aW9uIHN1Y2Nlc3NmdWwhJyk7XG5cbiAgICBjb25zdCBnbHVjb3NlID0gYXdhaXQgY2xpZW50LmdldEN1cnJlbnRHbHVjb3NlKCk7XG4gICAgY29uc3Qgc2Vzc2lvblN0YXR1cyA9IGNsaWVudC5nZXRTZXNzaW9uU3RhdHVzKCk7XG5cbiAgICBjb25zb2xlLmxvZygnJyk7XG4gICAgY29uc29sZS5sb2coJ0N1cnJlbnQgZ2x1Y29zZSByZWFkaW5nOicpO1xuICAgIGNvbnNvbGUubG9nKGAgIFZhbHVlOiAke2dsdWNvc2UudmFsdWV9IG1nL2RMYCk7XG4gICAgY29uc29sZS5sb2coYCAgVHJlbmQ6ICR7Z2x1Y29zZS50cmVuZH1gKTtcbiAgICBjb25zb2xlLmxvZyhgICBTdGF0dXM6ICR7Z2x1Y29zZS5jb2xvciA9PT0gJ2dyZWVuJyA/ICdJbiBSYW5nZScgOiBnbHVjb3NlLmNvbG9yID09PSAncmVkJyA/ICdDcml0aWNhbCcgOiAnT3V0IG9mIFJhbmdlJ31gKTtcbiAgICBjb25zb2xlLmxvZygnJyk7XG4gICAgY29uc29sZS5sb2coJ1Nlc3Npb24gaW5mbzonKTtcbiAgICBjb25zb2xlLmxvZyhgICBUb2tlbiB2YWxpZCB1bnRpbDogJHtzZXNzaW9uU3RhdHVzLmV4cGlyZXNBdD8udG9Mb2NhbGVTdHJpbmcoKSB8fCAnTi9BJ31gKTtcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUubG9nKGBDb25uZWN0aW9uIGZhaWxlZDogJHtlcnJvcn1gKTtcbiAgICBjb25zb2xlLmxvZygnJyk7XG4gICAgY29uc29sZS5sb2coJ1Ryb3VibGVzaG9vdGluZzonKTtcbiAgICBjb25zb2xlLmxvZygnICAxLiBWZXJpZnkgeW91ciBlbWFpbCBhbmQgcGFzc3dvcmQgYXJlIGNvcnJlY3QnKTtcbiAgICBjb25zb2xlLmxvZygnICAyLiBNYWtlIHN1cmUgeW91IGFyZSB1c2luZyBMaWJyZUxpbmtVcCBjcmVkZW50aWFscycpO1xuICAgIGNvbnNvbGUubG9nKCcgIDMuIE9wZW4gdGhlIExpYnJlTGlua1VwIGFwcCBhbmQgYWNjZXB0IGFueSBUZXJtcyAmIENvbmRpdGlvbnMnKTtcbiAgICBjb25zb2xlLmxvZygnICA0LiBFbnN1cmUgc29tZW9uZSBpcyBzaGFyaW5nIGRhdGEgd2l0aCB5b3UgKG9yIHNoYXJlIHlvdXIgb3duIGRhdGEpJyk7XG4gICAgY29uc29sZS5sb2coJyAgNS4gQ2hlY2sgdGhhdCB5b3VyIHJlZ2lvbiBzZXR0aW5nIGlzIGNvcnJlY3QnKTtcbiAgICBybC5jbG9zZSgpO1xuICAgIHByb2Nlc3MuZXhpdCgxKTtcbiAgfVxuXG4gIGNvbnNvbGUubG9nKCcnKTtcbiAgY29uc29sZS5sb2coJ0NvbmZpZ3VyYXRpb24gY29tcGxldGUhJyk7XG4gIGNvbnNvbGUubG9nKCcnKTtcbiAgY29uc29sZS5sb2coJ05leHQgc3RlcHM6Jyk7XG4gIGNvbnNvbGUubG9nKCcgIDEuIEFkZCB0aGUgc2VydmVyIHRvIENsYXVkZSBEZXNrdG9wIGNvbmZpZ3VyYXRpb24nKTtcbiAgY29uc29sZS5sb2coJyAgMi4gUmVzdGFydCBDbGF1ZGUgRGVza3RvcCcpO1xuICBjb25zb2xlLmxvZygnICAzLiBBc2sgQ2xhdWRlIGFib3V0IHlvdXIgZ2x1Y29zZSBsZXZlbHMhJyk7XG5cbiAgcmwuY2xvc2UoKTtcbn1cblxubWFpbigpLmNhdGNoKChlcnJvcikgPT4ge1xuICBjb25zb2xlLmVycm9yKCdFcnJvcjonLCBlcnJvcik7XG4gIHByb2Nlc3MuZXhpdCgxKTtcbn0pO1xuIl19